<div id="statistics">
    <span id="piwik-playcount" class="discreet" style="display:none; "><span class="views"></span> views</span>
    <span id="piwik-downloads" class="discreet" style="display:none;"> - <span class="views"></span> downloads</span>
</div>

<script>

function getPlayCount() {
    jq.ajax({
        url: location.href.split('/view')[0] + '/@@playcount',
        type: "GET",
        dataType: "json",
        cache: false,
        success: function(data) {
            console.log(data);
            if (data[0] > 0) {
                jq('#piwik-playcount span.views').html(data[0]);
                jq('#piwik-playcount').fadeIn();
            }
        },
        error: function(){
        }
    });
}

function getDownCount() {
    jq.ajax({
        url: location.href.split('/view')[0] + '/@@downcount',
        type: "GET",
        cache: false,
        dataType: "json",
        success: function(data) {
            console.log('down: ' + data);
            if (data[0] > 0) {
                jq('#piwik-downloads span.views').html(data[0]);
                jq('#piwik-downloads').fadeIn();
            }
        },
        error: function(jqXHR, textStatus, errorThrown){ alert(textStatus);
        }
    });
}


jq(window).load(function() {getPlayCount(); getDownCount();});

jq(function () {
    jq("p.download-block a").click(function() {
        setTimeout("piwikTracker.trackLink(location.href.split('/view')[0],'download')",1000);
        getDownCount();
        setTimeout("getDownCount()",5000);
    });

    jq(window).load(function() {
        getPlayCount();
        $('video').mediaelementplayer().bind('play',function(){
            piwikTracker.trackLink(location.href.split('/view')[0],'link');
            getPlayCount();
            //console.log('trackLink ' + location.href.split('/view')[0]);
        });    

        $('a[href$="at_download/file"]').click(function() {
            alert('download1');
            setTimeout("piwikTracker.trackLink(location.href.split('/view')[0],'download')",1000);    
            setTimeout("getDownCount()",5000);
        });
    
        $('a[href="' + location.href.split('/view')[0] + '"]').click(function() {
            alert('download2');
            setTimeout("piwikTracker.trackLink(location.href.split('/view')[0],'download')",1000);    
            setTimeout("getDownCount()",5000);
        });
    });
});

</script>
